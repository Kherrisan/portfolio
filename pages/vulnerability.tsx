import type { NextPage } from 'next'
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome'
import { faShieldHalved } from '@fortawesome/free-solid-svg-icons'

import Head from 'next/head'

import { H1 } from '../components/Header'
import { HrStyle } from '../components/Border'
import { vulnerabilities, VulnerabilityProps } from '../config/vulnerability'

const Badge = ({ type, children, href }: { type: 'cve' | 'cnvd' | 'cwe', children: React.ReactNode, href?: string }) => {
    let color = '';
    switch (type) {
        case 'cve':
            color = 'bg-red-600/10 text-red-600 hover:bg-red-600/20';
            break;
        case 'cnvd':
            color = 'bg-orange-600/10 text-orange-600 hover:bg-orange-600/20';
            break;
        case 'cwe':
            color = 'bg-blue-600/10 text-blue-600 hover:bg-blue-600/20';
            break;
        default:
            color = 'bg-gray-600/10 text-gray-600 hover:bg-gray-600/20';
            break;
    }
    
    const className = "px-2 py-1 rounded font-mono text-sm font-bold transition-all duration-150 " + color;
    
    if (href) {
        return (
            <a 
                href={href} 
                target='_blank' 
                rel="noreferrer"
                className={className + " cursor-pointer inline-block"}
            >
                {children}
            </a>
        );
    }
    
    return (
        <span className={className}>
            {children}
        </span>
    )
}

const VulnerabilityItem = ({ year, cve, cnvd, vender, product, href, cwe, description }: VulnerabilityProps) => {
    // 生成各个标识符的链接
    const cveLink = cve ? `https://www.cve.org/CVERecord?id=${cve}` : undefined;
    const cnvdLink = cnvd ? `https://www.cnvd.org.cn/flaw/show/${cnvd}` : undefined;
    const cweNumber = cwe ? cwe.replace('CWE-', '') : undefined;
    const cweLink = cweNumber ? `https://cwe.mitre.org/data/definitions/${cweNumber}.html` : undefined;
    
    return (
        <div className="grid grid-cols-10 sm:grid-cols-12 pt-6 pb-4 border-b border-gray-200 dark:border-gray-800">
            <div className="col-span-2 text-gray-500/90 dark:text-gray-400/90">
                {year}
            </div>
            <div className="col-span-10">
                <div className='flex flex-wrap gap-2 mb-2'>
                    {cve && <Badge type="cve" href={cveLink}>{cve}</Badge>}
                    {cnvd && <Badge type="cnvd" href={cnvdLink}>{cnvd}</Badge>}
                    {cwe && <Badge type="cwe" href={cweLink}>{cwe}</Badge>}
                </div>
                <div className='heading-text font-bold text-lg mb-2'>
                    <FontAwesomeIcon 
                        icon={faShieldHalved} 
                        style={{ width: '1em', height: '1em', fontSize: '1em', verticalAlign: 'middle' }} 
                        className="inline-block mr-2 text-red-500" 
                    />
                    {vender} {product}
                </div>
                <div className='secondary-text opacity-80 mb-2'>
                    {description}
                </div>
            </div>
        </div>
    )
}

const Vulnerability: NextPage = () => {
    return (
        <>
            <Head>
                <title>KendrickZou - Vulnerability</title>
            </Head>

            <div className="container mx-auto max-w-4xl px-6">
                <H1 css={HrStyle}>Vulnerability</H1>

                {vulnerabilities.map((item, index) => (
                    <VulnerabilityItem 
                        key={index}
                        year={item.year}
                        cve={item.cve}
                        cnvd={item.cnvd}
                        vender={item.vender}
                        product={item.product}
                        href={item.href}
                        cwe={item.cwe}
                        description={item.description}
                    />
                ))}

                {vulnerabilities.length === 0 && (
                    <div className="text-center py-12 secondary-text opacity-50">
                        No vulnerabilities reported yet
                    </div>
                )}
            </div>

            <div className="flex-1" />
        </>
    )
}

export default Vulnerability

